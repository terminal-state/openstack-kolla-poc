---
- name: Import Kolla-Ansible installation tasks
  ansible.builtin.import_tasks: install_kolla.yml
  tags: [install]

- name: Import configuration generation tasks
  ansible.builtin.import_tasks: generate_configs.yml
  tags: [config]

- name: Import SSH key distribution tasks
  ansible.builtin.import_tasks: ssh_keys.yml
  tags: [ssh]

- name: Import validation tasks
  ansible.builtin.import_tasks: validate.yml
  tags: [validate]

- name: Create Kolla config override directory
  ansible.builtin.file:
    path: /etc/kolla/config/nova
    state: directory
    mode: '0755'

- name: Override nova CPU mode for nested virtualization
  ansible.builtin.copy:
    content: |
      [libvirt]
      cpu_mode = none
    dest: /etc/kolla/config/nova.conf
    mode: '0644'
